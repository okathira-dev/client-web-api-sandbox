# PDF Compressor (Ghostscript WASM)

完全クライアントサイドでPDFを圧縮するWebアプリケーションです。Ghostscript WASMを使用して、ブラウザ内でPDF圧縮を行います。

## 概要

このプロジェクトは、WebAssemblyにコンパイルされたGhostscriptを使用して、クライアントサイドのみでPDF圧縮を実現します。ファイルはサーバーにアップロードされないため、プライバシーを保護しながらPDFを圧縮できます。

## 機能

- **完全クライアントサイド処理**: ファイルはブラウザ内でのみ処理され、サーバーにアップロードされません
- **プリセットモード**: `/screen`, `/ebook`, `/printer`, `/prepress` などの一般的なプリセットから選択可能
- **詳細設定**: 画像解像度、ダウンサンプリング方式、フォント埋め込みなど、細かい設定が可能
- **カスタムコマンドモード**: 上級者向けに、Ghostscriptのコマンドライン引数を直接編集可能
- **リアルタイムログ**: 圧縮処理のログをリアルタイムで表示
- **圧縮率表示**: 元のファイルサイズと圧縮後のファイルサイズを比較表示

## 使い方

1. **PDFファイルを選択**: 「PDFを選択」ボタンをクリックして、圧縮したいPDFファイルを選択します
2. **圧縮設定を選択**:
   - プリセットを選択（推奨: `/ebook` - バランスの取れた圧縮）
   - 互換性レベルを選択（1.3, 1.4, 1.5）
   - 必要に応じて、画像解像度やその他の詳細設定を調整
3. **実行**: 「実行」ボタンをクリックして圧縮を開始します
4. **ダウンロード**: 圧縮が完了したら、「ダウンロード」ボタンをクリックして圧縮されたPDFをダウンロードします

### プリセットについて

- `/screen`: 画面表示用（最小サイズ、72dpi）
- `/ebook`: 電子書籍用（バランス重視、150dpi）- 推奨
- `/printer`: 印刷用（高品質、300dpi）
- `/prepress`: 印刷入稿用（最高品質、300dpi、CMYK対応）

### カスタムコマンドモード

上級者向けに、Ghostscriptのコマンドライン引数を直接編集できます：

1. 「カスタムコマンド」トグルをオンにします
2. 現在のGUI設定から生成されたコマンドが表示されます
3. コマンドを自由に編集できます
4. 「コマンドをコピー」ボタンでクリップボードにコピーできます

## 技術スタック

- **React + TypeScript**: UIフレームワーク
- **Material-UI (MUI)**: UIコンポーネントライブラリ
- **Ghostscript WASM**: PDF圧縮エンジン
- **Web Worker**: UIスレッドをブロックせずにWASMを実行
- **Vite**: ビルドツール

## アーキテクチャ

```plaintext
1. ユーザーがPDFファイルを選択
2. ファイルをArrayBufferとして読み込み
3. Web WorkerでGhostscript WASMを実行
4. Emscripten FSにinput.pdfとして書き込み
5. Ghostscriptコマンドを実行
6. output.pdfを読み出してBlobに変換
7. ダウンロードリンクを生成
```

## 参考資料

このプロジェクトは以下のリソースを参考にしています：

- [ps-wasm (Ghostscript WASM ラッパー)](https://github.com/ochachacha/ps-wasm)
- [Playing around with Webassembly: Ghostscript](https://meyer-laurent.com/playing-around-webassembly-and-ghostscript)

## 注意事項

- **大きいPDFファイル**: 大きいPDFファイル（数十MB以上）を処理する場合、ブラウザのメモリやCPUに負荷がかかる可能性があります
- **ブラウザ互換性**: 主にChromium系ブラウザでテストされています。Firefox、Safariでも動作しますが、パフォーマンスが異なる場合があります

## トラブルシューティング

### よくある問題

1. **圧縮が失敗する**

   - コンソールログを確認してエラーメッセージを確認してください
   - PDFファイルが破損していないか確認してください
   - ブラウザのメモリが不足していないか確認してください

2. **圧縮後のファイルサイズが大きくなる**

   - 元のPDFが既に最適化されている場合、圧縮してもサイズが減少しないことがあります
   - プリセットを `/screen` に変更すると、より積極的に圧縮されます

3. **圧縮に時間がかかる**
   - 大きいPDFファイルや多くの画像を含むPDFの処理には時間がかかります

## ディレクトリ構造

```plaintext
/pdf-compressor-wasm
  /workers - Web Workerファイル
    gsRunner.ts - Workerとのインターフェース
    gsWorker.ts - Ghostscript WASM実行
  /build - ビルドスクリプト（WASMファイル生成用）
  App.tsx - メインアプリケーションコンポーネント
  main.tsx - エントリポイント
  index.html - HTMLエントリポイント
  README.md - このファイル
```
